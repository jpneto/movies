---
title: "My Movies"
author: "Jo√£o Neto"
date: "March 2021"
output: html_document
---

<!--  To run shiny server place this above
runtime: shiny
-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning=FALSE, message=FALSE, echo=FALSE}
library(dplyr)
library(magrittr)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df <- read.csv2('best_movies_info.csv', encoding='UTF-8')
df$Score <- as.numeric(df$Score)
df$numVotes <- as.numeric(df$numVotes)
df$averageRating <- as.numeric(df$averageRating)
df %>% 
  rename(ImdbRate = averageRating) %>% 
  rename(Rating = Score) %>% 
  rename(Votes = numVotes) %>% 
  rename(Director = primaryName) %>% 
  select(-directors) %>% 
  select(-IMDB) -> df
```

This table includes movies I think show an above than average quality in either plot, main themes and overall cinematography. This list represents around one third of all the movies I've seen and is, obviously, quite subjective :-)

```{r, warning=FALSE, message=FALSE, echo=FALSE}
library(DT)
DT::datatable(df) 
```

## Number of Selected Movies per Year

```{r, echo=FALSE}
min.score <- 7
my.color <- 'steelblue'
```

Showing movies with a minimal rating of `r min.score`. I still have ~25 movies to watch from 1970-2020, but there are hundreds to see from the 1950s and 1960s. Before exploring the 1960s, I'm trying to consolidate movies scores from the last 50 years. Anyway, here are the wishlists from the previous two decades:

+ [wishlist from the 1950s](https://www.imdb.com/list/ls089830524/?pf_rd_m=A2FGELUUNOQJNL&pf_rd_p=4dc7ad1a-76a6-49eb-9acb-5d6959572df8&pf_rd_r=G8MGE7R65T5SR6M8362N&pf_rd_s=right-4&pf_rd_t=48201&pf_rd_i=watchlist&ref_=ttls_vw_grd&sort=list_order,asc&st_dt=&mode=grid&page=1)

+ [wishlist from the 1960s](https://www.imdb.com/list/ls089835133/?pf_rd_m=A2FGELUUNOQJNL&pf_rd_p=4dc7ad1a-76a6-49eb-9acb-5d6959572df8&pf_rd_r=E1XAD5HDMTDS4WJ8NJPH&pf_rd_s=right-4&pf_rd_t=48201&pf_rd_i=watchlist&ref_=ttls_vw_grd&sort=list_order,asc&st_dt=&mode=grid&page=1)

```{r, fig.width=12, echo=FALSE, eval=TRUE}
df %>% 
  filter(Rating >= min.score) %>% 
  count(Year, sort=TRUE) %>% 
  arrange( Year ) -> df2

par(mar=c(3,1,1,1))
plt <- barplot(df2$n, names.arg=df2$Year, las=2, col=my.color, ylim=c(0,max(df2$n)*1.25), yaxt="n")
text(x=plt, y=df2$n, label=df2$n, pos=3, cex=0.8, col='blue')
```

```{r, echo=FALSE, eval=FALSE}
inputPanel(
  sliderInput("score", label="minimum movie score", 
              min=7, max=10, value=7.5, step=0.25)
)

output$g1 <- renderPlot({
  df %>% 
  filter(Rating >= input$score) %>% 
  count(Year, sort=TRUE) %>% 
  arrange( Year ) -> df2

  par(mar=c(3,1,1,1))
  plt <- barplot(df2$n, names.arg=df2$Year, las=2, col=my.color,
                 ylim=c(0,max(df2$n)*1.25), yaxt="n")
  text(x=plt, y=df2$n, label=df2$n, pos=3, cex=0.8, col='blue')
})

plotOutput("g1", height="400px")
br()
```


## Number of Selected Movies per Decade

Again using the same filter as above:

```{r, fig.width=6, fig.height=3, echo=FALSE, eval=TRUE}
df %>% 
  filter(Rating >= min.score) %>% 
  count(Decade, sort=TRUE) %>% 
  arrange( Decade ) -> df2

par(mar = c(2.5, .5, .5, .5))
plt <- barplot(df2$n, names.arg=df2$Decade, las=1, col=my.color, ylim=c(0,max(df2$n)*1.25), yaxt="n")
text(x=plt, y=df2$n+0.8, label=df2$n, pos=3, cex=1, col=my.color)
```

```{r, echo=FALSE, eval=FALSE}
inputPanel(
  sliderInput("score2", label="minimum movie score", 
              min=7, max=10, value=7.5, step=0.25)
)

output$g2 <- renderPlot({
df %>% 
  filter(Rating >= input$score2) %>% 
  count(Decade, sort=TRUE) %>% 
  arrange( Decade ) -> df2

  plt <- barplot(df2$n, names.arg=df2$Decade, las=1, col=my.color,
                 ylim=c(0,max(df2$n)*1.25), yaxt="n")
  text(x=plt, y=df2$n+0.8, label=df2$n, pos=3, cex=1, col='blue')
})

plotOutput("g2", height="400px")
br()
```

## Movie quality per Decade

Let's see how many good films (rating at least 8) each decade produced,

```{r, fig.width=6, fig.height=3, echo=FALSE}
rotate_x <- function(data, column_to_plot, labels_vec, rot_angle) {
  ymax <- max(data[[column_to_plot]])*1.25
  plt <- barplot(data[[column_to_plot]], col='steelblue', xaxt="n", yaxt="n", ylim=c(0,ymax))
  text(plt, par("usr")[3], labels = labels_vec, srt = rot_angle, 
       adj = c(1.1,1.1), xpd = TRUE, cex=1) 
  text(x = plt, y = data$n, label = data$n, pos = 3, cex = 1.2, col = my.color)
}

df %>% 
  filter(Rating >= 8) %>% 
  count(Decade, sort=TRUE) %>% 
  arrange( Decade ) -> df2

par(mar = c(2.5, .5, .5, .5))
rotate_x(df2, 'n', df2$Decade, 45)
```

And how many great films (rating at least 9) each decade produced,

```{r, fig.width=6, fig.height=3, echo=FALSE}
df %>% 
  filter(Rating >= 9) %>% 
  count(Decade, sort=TRUE) %>% 
  arrange( Decade ) -> df2

par(mar = c(2.5, .5, .5, .5))
rotate_x(df2, 'n', df2$Decade, 45)
```

And masterpieces (rating of at least 9.5) per decade,

```{r, fig.width=6, fig.height=3, echo=FALSE}
df %>% 
  filter(Rating >= 9.5) %>% 
  count(Decade, sort=TRUE) %>% 
  arrange( Decade ) -> df2

par(mar = c(2.5, .5, .5, .5))
rotate_x(df2, 'n', df2$Decade, 45)
```

The next plot shows how different rating ranges are represented by decade,

```{r, fig.width=8, fig.height=6, warning=FALSE, echo=FALSE}
df %>% 
  mutate(interval = cut(df$Rating, breaks=c(6.9,7.4,7.9,8.4,8.9,9.4,10))) %>% 
  group_by(Decade, interval, .drop = FALSE) %>% 
  summarise(count=n()) -> df3

mat <- matrix(df3$count, ncol=6, byrow=T)

library(RColorBrewer)
par(mar = c(2.5, 2.5, 1.5, 1.5))
# https://www.datanovia.com/en/blog/the-a-z-of-rcolorbrewer-palette/
barplot(mat %>% t, names.arg=unique(df3$Decade), ylim=c(0,200), col=brewer.pal(6, "Blues") )
legend(7.5, 180, rev(c('7+','7.5+','8+','8.5+','9+','9.5+')), 
       col=rev(brewer.pal(7, "Blues")), pch=15)
```

## Movies per Directors

Let's check directors with multiple movies in the list,

```{r, fig.width=12, fig.height=8, echo=FALSE}
df %>% 
  count(Director, sort=TRUE) %>% 
  filter(!is.na(Director)) %>% 
  filter(n>4) -> df4

par(mar=c(1,11,1,6))
plt <- barplot(df4$n, col='steelblue', horiz=TRUE, names.arg=df4$Director, 
               las=1, xlim=c(0,10+max(df4$n)), xaxt='n')
text(y=plt, x=df4$n+0.8, label=df4$n, pos = 2, cex = 0.8, col='blue')
```

Directors with movies with a rating of at least 8.5,

```{r, fig.width=12, fig.height=6, echo=FALSE}
df %>% 
  filter(Rating >= 8.5) %>% 
  count(Director, sort=TRUE) %>% 
  filter(!is.na(Director)) %>% 
  filter(n>2) -> df5

par(mar=c(1,11,1,1))
plt <- barplot(df5$n, col='steelblue', horiz=TRUE, names.arg=df5$Director, 
               las=1, xlim=c(0,10+max(df5$n)), xaxt='n')
text(y=plt, x=df5$n+0.5, label=df5$n, pos = 2, cex = 0.8, col='blue')
```

And finally who made the masterpieces (>=9.5),

```{r, fig.width=12, fig.height=6, echo=FALSE}
df %>% 
  filter(Rating >= 9.5) %>% 
  count(Director, sort=TRUE) %>% 
  filter(!is.na(Director)) -> df5

par(mar=c(1,11,1,1))
plt <- barplot(df5$n, col='steelblue', horiz=TRUE, names.arg=df5$Director, 
               las=1, xlim=c(0,10+max(df5$n)), xaxt='n')
text(y=plt, x=df5$n+0.5, label=df5$n, pos = 2, cex = 0.8, col='blue')
```

## Movies per Genre

```{r, fig.width=12, fig.height=6, echo=FALSE}
df %>% 
  #filter(Score >= min.score) %>% 
  count(Genre) %>% 
  arrange( desc(Genre) ) -> df6

par(mar=c(1,11,1,1))
plt <- barplot(df6$n, col='steelblue', horiz=TRUE, names.arg=df6$Genre, 
               las=1, xlim=c(0,20+max(df6$n)), xaxt='n')
text(y=plt, x=df6$n+8, label=df6$n, pos = 2, cex = 0.8, col='blue')
```

## Movies per Country

Most movies I see are from Hollywood, but let's check how others countries are represented:

```{r, fig.width=12, fig.height=8, warning=FALSE, echo=FALSE}
df %>% 
  filter(Rating >= 7) %>% 
  filter (Country!='USA') %>% 
  count(Country, sort=TRUE) %>% 
  arrange( desc(Country) ) -> df2

par(mar=c(1,11,1,6))
plt <- barplot(df2$n, col='steelblue', horiz=TRUE, names.arg=df2$Country, 
               las=1, xlim=c(0,10+max(df2$n)), xaxt='n')
text(y=plt, x=df2$n+2.5, label=df2$n, pos = 2, cex = 0.8, col='blue')
```